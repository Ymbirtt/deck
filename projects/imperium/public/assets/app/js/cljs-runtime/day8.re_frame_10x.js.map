{"version":3,"sources":["day8/re_frame_10x.cljs"],"mappings":"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","names":["js/goog.define","day8.re-frame-10x/debug?","day8.re-frame-10x/resizer-style","draggable-area","day8.re-frame-10x/ease-transition","day8.re-frame-10x/devtools-outer","opts","position","day8.re_frame_10x.inlined_deps.reagent.v1v0v0.reagent.core.atom","panel-width%","day8.re_frame_10x.inlined_deps.re_frame.v1v1v2.re_frame.core.subscribe","showing?","dragging?","pin-to-bottom?","selected-tab","window-width","js/window.innerWidth","handle-window-resize","day8.re-frame-10x.inlined-deps.re-frame.v1v1v2.re-frame.core/dispatch","e","window-width-val","cljs.core/reset!","handle-keys","tag-name","entering-input?","cljs.core/contains?","cljs.core._EQ_","handle-mousemove","cljs.core/deref","x","y","new-window-width","width%","handle-mouse-up","day8.re_frame_10x.inlined_deps.reagent.v1v0v0.reagent.core.create_class","js/window.addEventListener","js/window.removeEventListener","left","transition","day8.re-frame-10x.components.re-com/box","day8.re-frame-10x.components.re-com/h-box","day8.re-frame-10x.navigation.views/devtools-inner","day8.re-frame-10x/traced-result","trace-id","fragment-id","trace","cljs.core/first","p1__52380#","cljs.core.filter","cljs.core.get_in","day8.re-frame-10x.inlined-deps.re-frame.v1v1v2.re-frame.db/app-db","day8.re-frame-10x/factory-reset!","day8.re-frame-10x/show-panel!","show-panel?","day8.re-frame-10x/inject!","day8.re-frame-10x.inlined-deps.re-frame.v1v1v2.re-frame.core/clear-subscription-cache!","container","day8.re-frame-10x.tools.shadow-dom/shadow-root","js/document","day8.re_frame_10x.inlined_deps.reagent.v1v0v0.reagent.dom.render","day8.re-frame-10x/patch!","day8.reagent.impl.component/patch-custom-wrapper","day8.reagent.impl.component/patch-wrap-funs","day8.reagent.impl.batching/patch-next-tick","day8.re-frame-10x/init!","day8.re-frame-10x.inlined-deps.re-frame.v1v1v2.re-frame.core/dispatch-sync"],"sourcesContent":["(ns day8.re-frame-10x\n  (:require\n    [day8.re-frame-10x.inlined-deps.reagent.v1v0v0.reagent.core   :as r]\n    [day8.re-frame-10x.inlined-deps.reagent.v1v0v0.reagent.dom    :as rdom]\n    [day8.re-frame-10x.inlined-deps.re-frame.v1v1v2.re-frame.core :as rf]\n    [day8.re-frame-10x.inlined-deps.spade.v1v1v0.spade.runtime    :as spade.runtime]\n    [day8.reagent.impl.batching                                   :refer [patch-next-tick]]\n    [day8.reagent.impl.component                                  :refer [patch-wrap-funs patch-custom-wrapper]]\n    [day8.re-frame-10x.tools.shadow-dom                           :as tools.shadow-dom]\n    [day8.re-frame-10x.events                                     :as events]\n    [day8.re-frame-10x.components.re-com                          :as rc]\n    [day8.re-frame-10x.navigation.views                           :as container]\n    [day8.re-frame-10x.panels.settings.subs                       :as settings.subs]\n    [day8.re-frame-10x.panels.settings.events                     :as settings.events]\n    [day8.re-frame-10x.styles                                     :as styles]))\n\n(goog-define debug? false)\n\n#_(defonce real-schedule reagent.impl.batching/schedule)\n#_(defonce do-after-render-trace-scheduled? (atom false))\n\n\n\n\n(defn resizer-style [draggable-area]\n  {:position \"absolute\" :z-index 2 :opacity 0\n   :left     (str (- (/ draggable-area 2)) \"px\") :width \"10px\" :height \"100%\" :top \"0px\" :cursor \"col-resize\"})\n\n(def ease-transition \"left 0.2s ease-out, top 0.2s ease-out, width 0.2s ease-out, height 0.2s ease-out\")\n\n(defn devtools-outer [opts]\n  ;; Add clear button\n  ;; Filter out different trace types\n  (let [position             (r/atom :right)\n        panel-width%         (rf/subscribe [::settings.subs/panel-width%])\n        showing?             (rf/subscribe [::settings.subs/show-panel?])\n        dragging?            (r/atom false)\n        pin-to-bottom?       (r/atom true)\n        selected-tab         (rf/subscribe [::settings.subs/selected-tab])\n        window-width         (r/atom js/window.innerWidth)\n        handle-window-resize (do (rf/dispatch [::settings.events/window-width js/window.innerWidth]) ;; Set initial\n                                 (fn [e]\n                                   ;; N.B. I don't think this should be a perf bottleneck.\n                                   (let [window-width-val js/window.innerWidth]\n                                     (rf/dispatch [::settings.events/window-width window-width-val])\n                                     (reset! window-width window-width-val))))\n        handle-keys          (fn [e]\n                               (let [tag-name        (.-tagName (.-target e))\n                                     entering-input? (contains? #{\"INPUT\" \"SELECT\" \"TEXTAREA\"} tag-name)]\n                                 (when (and (not entering-input?)\n                                            (= (.-key e) \"h\")\n                                            (.-ctrlKey e))\n                                   (rf/dispatch [::settings.events/user-toggle-panel])\n                                   (.preventDefault e))))\n        handle-mousemove     (fn [e]\n                               (when @dragging?\n                                 (let [x                (.-clientX e)\n                                       y                (.-clientY e)\n                                       new-window-width js/window.innerWidth]\n                                   (.preventDefault e)\n                                   (let [width% (/ (- new-window-width x) new-window-width)]\n                                     (when (<= width% 0.9)\n                                       (rf/dispatch [::settings.events/panel-width% width%])))\n                                   (reset! window-width new-window-width))))\n        handle-mouse-up      (fn [e] (reset! dragging? false))]\n    (r/create-class\n      {:component-did-mount    (fn []\n                                 (js/window.addEventListener \"keydown\" handle-keys)\n                                 (js/window.addEventListener \"mousemove\" handle-mousemove)\n                                 (js/window.addEventListener \"mouseup\" handle-mouse-up)\n                                 (js/window.addEventListener \"resize\" handle-window-resize))\n       :component-will-unmount (fn []\n                                 (js/window.removeEventListener \"keydown\" handle-keys)\n                                 (js/window.removeEventListener \"mousemove\" handle-mousemove)\n                                 (js/window.removeEventListener \"mouseup\" handle-mouse-up)\n                                 (js/window.removeEventListener \"resize\" handle-window-resize))\n       :display-name           \"devtools outer\"\n       :reagent-render         (fn []\n                                 (let [draggable-area 10\n                                       left           (if @showing? (str (* 100 (- 1 @panel-width%)) \"%\")\n                                                                    (str @window-width \"px\"))\n                                       transition     (if @dragging?\n                                                        \"\"\n                                                        ease-transition)]\n                                   [rc/box\n                                    :width  \"0px\"\n                                    :height \"0px\"\n                                    :style  {:position \"fixed\"\n                                             :top      \"0px\"\n                                             :left     \"0px\"\n                                             :z-index  99999999}\n                                    :child [rc/h-box\n                                            :width (str (* 100 @panel-width%) \"%\")\n                                            :height \"100%\"\n                                            :style {:position   \"fixed\"\n                                                    :z-index    1\n                                                    :box-shadow \"rgba(0, 0, 0, 0.3) 0px 0px 4px\"\n                                                    :background \"white\"\n                                                    :left       left\n                                                    :top        \"0px\"\n                                                    :transition transition}\n                                            :children [[:div.panel-resizer (when @showing? {:style         (resizer-style draggable-area)\n                                                                                            :on-mouse-down #(reset! dragging? true)})]\n                                                       [container/devtools-inner opts]]]]))})))\n\n\n\n\n\n\n(defn traced-result [trace-id fragment-id]\n  ;; TODO: this is not terribly efficient, figure out how to get the index of the trace directly.\n  (let [trace (first (filter #(= trace-id (:id %)) (get-in @day8.re-frame-10x.inlined-deps.re-frame.v1v1v2.re-frame.db/app-db [:traces :all])))]\n    (get-in trace [:tags :code fragment-id :result])))\n\n(defn ^:export factory-reset! []\n  (rf/dispatch [::settings.events/factory-reset]))\n\n(defn ^:export show-panel! [show-panel?]\n  (rf/dispatch [::settings.events/show-panel? show-panel?]))\n\n;; --- NEW ---\n\n\n\n(defn inject!\n  []\n  (rf/clear-subscription-cache!)\n  (let [container (tools.shadow-dom/shadow-root js/document \"--re-frame-10x--\")]\n    (rdom/render\n      [devtools-outer\n       {:panel-type :inline\n        :debug?     debug?}] container)))\n\n(defn patch!\n  \"Sets up any initial state that needs to be there for tracing. Does not enable tracing.\"\n  []\n  (patch-custom-wrapper)\n  (patch-wrap-funs)\n  (patch-next-tick))\n\n(defn init!\n  []\n  (patch!)\n  (rf/dispatch-sync [::events/init {:debug? debug?}])\n  (inject!))"]}